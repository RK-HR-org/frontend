# hh_search_reference.xlsx — структура для Coze Table Knowledge

Этот файл описывает, как должна быть устроена таблица `hh_search_reference.xlsx`, которую можно загрузить в Coze как **табличное знание**.  
По этой структуре можно собрать реальный `.xlsx` в Excel/Google Sheets.

Рекомендуется создать минимум следующие листы:

- `fields_overview`
- `hh_areas`
- `hh_districts`
- `hh_skills`
- `hh_professional_roles`
- `hh_employment`
- `hh_schedule`
- `hh_experience_categories`

## Лист: fields_overview

**Назначение**: связать поля JSON от Cozy, поля формы HH и параметры HH API.

Рекомендуемые колонки:

| column               | описание                                                                                           |
|----------------------|----------------------------------------------------------------------------------------------------|
| json_key             | Ключ или путь в JSON, возвращаемом Cozy (`text_queries[*].field`, `experience.hh_experience_id`) |
| form_field           | Поле в `searchForm`/интерфейсе (`ageFrom`, `ageTo`, `experience[]`, `areas[]`)                    |
| hh_api_param         | Имя параметра в запросе к HH API (если есть)                                                      |
| data_type            | Тип данных (number, string, string[], object, enum и т.п.)                                        |
| allowed_values_source| Откуда берутся допустимые значения (ручной ввод, лист словаря, OpenAPI)                           |
| nullable             | Можно ли оставлять `null` / пустой массив                                                         |
| examples_positive    | Примеры фраз пользователя, которые ДОЛЖНЫ приводить к заполнению поля                             |
| examples_negative    | Примеры фраз, которые НЕ должны приводить к заполнению поля                                       |
| notes                | Дополнительные замечания/правила                                                                   |

Примеры строк (фрагмент):

| json_key                       | form_field          | hh_api_param          | data_type     | allowed_values_source      | nullable | examples_positive                                                                 | examples_negative                                                 | notes                                                                                   |
|--------------------------------|---------------------|-----------------------|--------------|----------------------------|----------|------------------------------------------------------------------------------------|-------------------------------------------------------------------|-----------------------------------------------------------------------------------------|
| text_queries[*].text           | textQueries[].text  | text                  | string       | свободный текст            | false    | «python разработчик», «маркетолог в FMCG»                                         | «Москва», «от 3 лет», «зп от 100к»                                | Только содержимое текстового поиска, без возраста/зарплаты/географии.                  |
| text_queries[*].field          | textQueries[].field | search_field          | enum         | фиксированный список       | false    | «поиск по опыту», «по навыкам» → experience/skills                                 | —                                                                 | Значения: everywhere, title, education, experience, experience_company, …, skills.      |
| experience.hh_experience_id    | experience[]        | experience            | enum         | лист `hh_experience_categories` | true     | «не менее 3 лет», «senior разработчик»                                            | «опыт в продажах», «есть релевантный опыт»                        | Не заполнять без явного указания длительности/уровня.                                   |
| age.age_from                   | ageFrom             | age_from              | number       | ручной разбор чисел        | true     | «не моложе 25», «от 30 до 45»                                                     | «молодой специалист», «зрелый кандидат»                           | Только при наличии числа/числа прописью.                                                |
| age.age_to                     | ageTo               | age_to                | number       | ручной разбор чисел        | true     | «не старше 50», «до 40 лет»                                                       | «возраст не важен», «любого возраста»                             | —                                                                                       |
| salary.salary_from             | salaryFrom          | salary_from           | number       | ручной разбор чисел        | true     | «от 100к», «зп не ниже 80 тысяч», «вилка 80-120»                                   | «рыночная зарплата», «достойная оплата»                           | Числа в тысячах → *1000.                                                                |
| salary.salary_to               | salaryTo            | salary_to             | number       | ручной разбор чисел        | true     | «до 150к», «вилка 80-120»                                                         | «высокая зарплата», «хорошая оплата»                              | —                                                                                       |
| salary.currency                | currency            | currency              | enum         | лист валют (при необходимости) | true     | «в долларах», «в евро»                                                            | «зарплата 100к» (без явной валюты)                               | По умолчанию RUR, если не указано иное.                                                 |
| location.area_id               | areas[]             | area                 | number       | лист `hh_areas`            | true     | «Москва», «Санкт-Петербург», «Нижний Новгород»                                    | «удалёнка», «удалённая работа»                                   | При неоднозначности оставлять area_id пустым, использовать только area_name.           |
| location.area_name             | areas[]/labels      | —                     | string       | текст из промпта           | true     | Любое явно названное место («Москва», «СПб», «Екатеринбург»)                      | —                                                                 | Может использоваться, если area_id подобрать нельзя.                                   |
| schedule[]                     | schedule[]          | schedule              | string[]     | лист `hh_schedule`         | true     | «полный день», «сменный график», «удалёнка»                                       | «гибкий подход», без связи с рабочим графиком                     | —                                                                                       |
| employment[]                   | employment[]        | employment            | string[]     | лист `hh_employment`       | true     | «полная занятость», «частичная занятость», «проектная работа»                     | «офис/гибрид», если нет слов про тип занятости                    | —                                                                                       |
| skills[]                       | skills[]            | skills                | string[]     | лист `hh_skills` (по name/aliases) | true     | «1С-Бухгалтерия», «налоговая отчётность», «Python», «Django»                      | общие качества («коммуникабельность», «ответственность»)         | В JSON — человеко‑читаемые названия, ID навыков храним в таблице как json_value при необходимости. |
| languages[].id                 | languages[]         | languages             | string       | словарь языков HH          | true     | «английский B2», «upper-intermediate английский», «итальянский C1»                | «желательно знание иностранных языков» без конкретики            | Без уровня можно оставить только id; без явного языка — ничего не заполнять.           |
| languages[].level              | languages[]         | languages             | string/null  | словарь уровней HH         | true     | «английский B2», «английский upper-intermediate»                                   | «знание английского приветствуется» без уровня                   | —                                                                                       |
| gender                         | gender              | gender                | enum         | лист `GENDER` (hhDictionaries) | true     | «женщина», «женский пол», «не мужской» → female; «мужчина», «мужской пол» → male | «пол не важен», «любой пол»                                      | При отсутствии явного указания — null.                                                  |

## Лист: hh_areas

**Назначение**: соответствие текстовых названий регионов/городов значениям `area_id`/`json_value` для HH API.

Рекомендуемые колонки:

| column        | описание                                                  |
|---------------|-----------------------------------------------------------|
| area_id       | Числовой ID региона/города из HH API                     |
| parent_id     | ID родительского региона (страна/область и т.п.)         |
| name          | Официальное название региона/города                      |
| normalized_name | Нормализованное название (без сокращений, в нижнем регистре) |
| type          | Тип (country, region, city и т.п.)                        |
| aliases       | Варианты написания (СПб, Питер, Moscow и т.п.), опционально |
| json_value    | Значение, которое нужно подставлять в JSON (`area_id` или тот же ID) |

Использование:
- По колонкам `name` / `normalized_name` / `aliases` находить подходящий регион по тексту.
- В JSON ставить `location.area_id = json_value`, а `location.area_name = name`.

## Лист: hh_districts

**Назначение**: районы внутри городов (если потребуется точная фильтрация).

Рекомендуемые колонки:

| column     | описание                                |
|------------|-----------------------------------------|
| district_id| ID района в HH                          |
| area_id    | ID региона/города, к которому относится |
| name       | Название района                         |
| aliases    | Альтернативные названия, если есть      |
| json_value | Значение для использования в JSON/API   |

## Лист: hh_skills

**Назначение**: сопоставление названий навыков с ID (при необходимости) и алиасами.

Рекомендуемые колонки:

| column     | описание                                                   |
|------------|------------------------------------------------------------|
| skill_id   | ID навыка в HH (если используется)                         |
| name       | Основное название навыка                                   |
| aliases    | Через запятую — варианты написания, синонимы и транслит   |
| json_value | Значение, которое при необходимости можно использовать в API |

Использование:
- По `name`/`aliases` искать совпадение для слов/фраз из промпта.
- В JSON в `skills[]` можно возвращать `name` (человеко‑читаемый вариант); ID остаётся в таблице.

## Лист: hh_professional_roles

**Назначение**: справочник профессиональных ролей HH.

Рекомендуемые колонки:

| column     | описание                                  |
|------------|-------------------------------------------|
| role_id    | ID роли HH                                |
| name       | Название роли                             |
| aliases    | Синонимы/альтернативные формулировки      |
| json_value | Значение для использования в API/JSON     |

Этот лист можно использовать, если позже будет добавлено маппинг `professionalRole[]` в фильтрах.

## Лист: hh_employment

**Назначение**: типы занятости (совпадает с `EMPLOYMENT` в `hhDictionaries.ts`).

Рекомендуемые колонки:

| column     | описание                                            |
|------------|-----------------------------------------------------|
| value      | Значение типа занятости (full, part, project, …)   |
| name       | Человеко‑читаемое название                          |
| json_value | То же, что `value` (для использования в JSON/API)  |

## Лист: hh_schedule

**Назначение**: типы графика работы (совпадает с `SCHEDULE` в `hhDictionaries.ts`).

Рекомендуемые колонки:

| column     | описание                                            |
|------------|-----------------------------------------------------|
| value      | Значение графика (fullDay, shift, flexible, …)     |
| name       | Человеко‑читаемое название                          |
| json_value | То же, что `value`                                  |

## Лист: hh_experience_categories

**Назначение**: категориальный опыт (совпадает с `EXPERIENCE` в `hhDictionaries.ts` и `ExperienceDTO`).

Рекомендуемые колонки:

| column     | описание                                                         |
|------------|------------------------------------------------------------------|
| value      | ID категории (noExperience, between1And3, between3And6, moreThan6) |
| name       | Человеко‑читаемое описание                                      |
| examples   | Примеры фраз пользователя, которые попадают в эту категорию     |
| json_value | То же, что `value`                                               |

Примеры для `examples`:
- `noExperience`: «без опыта», «джун», «junior», «готовы рассматривать без опыта».
- `between1And3`: «от 1 до 3 лет», «1-3 года», «опыт от года».
- `between3And6`: «от 3 до 6 лет», «3+ года», «опыт не менее трёх лет».
- `moreThan6`: «более 6 лет», «senior», «lead».

---

На основе этой структуры можно:
- собрать xlsx‑файл и загрузить его в Coze как **text/table knowledge**;
- использовать колонки `name`/`aliases` для поиска подходящих строк по естественному языку;
- использовать `json_value` как единственный источник правды для значений, которые реально уходят в JSON/HH API.

